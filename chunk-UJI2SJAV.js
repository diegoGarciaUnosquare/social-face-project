import{a as I,d as N,e as j,f as L}from"./chunk-T6GQX6WA.js";import{b as B}from"./chunk-XOK3EHEZ.js";import{b as A,c as w}from"./chunk-2DFU5A5S.js";import{n as T,o as k,p as G}from"./chunk-UO3TCGKE.js";import{A as rt,B as at,C as st,G as lt,a as R,b as $,c as q,e as z,f as H,j as J,k as V,l as K,m as Q,n as W,o as g,p as X,q as Y,r as Z,s as tt,t as et,w as it,y as nt,z as ot}from"./chunk-ZN7JFSGK.js";import{H as D}from"./chunk-RMY26TJC.js";import{$b as u,Ca as h,Da as C,Eb as x,Ib as n,Ic as U,J as E,Jb as o,Kb as S,Mb as M,Pb as y,Rb as m,Zb as r,bc as O,eb as l,fb as v,rb as b,sa as F,u as f,xb as _,zb as p}from"./chunk-E7CHWM35.js";var d=function(e){return e[e.email=0]="email",e[e.browser=1]="browser",e}(d||{});var ut=G("settings"),ct=k(ut,e=>e.settings?e.settings:null);function ft(e,c){if(e&1){let a=M();n(0,"mat-card-header")(1,"mat-card-title",2),r(2),o()(),n(3,"mat-card-content",3)(4,"p",4),r(5,"Notifications Preference: "),n(6,"span"),r(7),o()(),n(8,"p",5),r(9,"Profile Visibility: "),n(10,"span"),r(11),o()(),n(12,"p",6),r(13,"Username "),n(14,"span"),r(15),o()(),n(16,"p",7),r(17,"Phone "),n(18,"span"),r(19),o()()(),n(20,"mat-card-actions",8)(21,"button",9),y("click",function(){h(a);let i=m(2);return C(i.exportToCSV())}),r(22,"Export to CSV"),o(),n(23,"button",10),y("click",function(){h(a);let i=m(2);return C(i.updateSettings())}),r(24,"Update Settings"),o()()}if(e&2){let a,t,i,s=m(2);l(2),u("",(a=s.settings())==null?null:a.username," | Settings"),l(5),u(" ",s.getNotificationPreference(),""),l(4),u(" ",s.getProfileVisibility()," "),l(4),u(" ",(t=s.settings())==null?null:t.username," "),l(4),u(" ",(i=s.settings())==null?null:i.phone," ")}}function gt(e,c){e&1&&S(0,"mat-spinner")}function ht(e,c){if(e&1&&(n(0,"button",22),r(1,"Submit Settings "),o()),e&2){let a=m(3);p("disabled",!a.formGroup.valid)}}function Ct(e,c){if(e&1){let a=M();n(0,"mat-card-header")(1,"mat-card-title",11),r(2,"Update Settings"),o()(),n(3,"mat-card-content",3)(4,"form",12),y("ngSubmit",function(){h(a);let i=m(2);return C(i.saveSettings())}),n(5,"div",13)(6,"mat-radio-group",14)(7,"mat-radio-button",15),r(8," Email Notifications "),o(),n(9,"mat-radio-button",16),r(10," Browser Notifications "),o()(),n(11,"mat-slide-toggle",17),r(12," Slide me! "),o(),n(13,"mat-form-field")(14,"mat-label",18),r(15,"Username"),o(),S(16,"input",19),o(),n(17,"mat-form-field")(18,"mat-label",20),r(19,"Phone number"),o(),S(20,"input",21),o(),_(21,gt,1,0,"mat-spinner")(22,ht,2,1),o()()()}if(e&2){let a=m(2);l(4),p("formGroup",a.formGroup),l(2),p("formControl",a.notificationPreferenceFormControl),l(5),p("formControl",a.profileVisibilityFormControl),l(5),p("formControl",a.usernameFormControl),l(4),p("formControl",a.phoneFormControl),l(),x(21,a.isLoading()?21:22)}}function bt(e,c){if(e&1&&(n(0,"mat-card",1),_(1,ft,25,5)(2,Ct,23,6),o()),e&2){let a=m();l(),x(1,a.isEditing()?2:1)}}var qt=(()=>{let c=class c{constructor(t,i){this.actions$=t,this.store=i,this.isEditing=b(!1),this.isLoading=b(!1),this.settings=b(null),this.notificationPreferenceFormControl=new g(""),this.profileVisibilityFormControl=new g(!1),this.usernameFormControl=new g("",V.required),this.phoneFormControl=new g("",V.required),this.formGroup=new W({notificationPreference:this.notificationPreferenceFormControl,profileVisibility:this.profileVisibilityFormControl,username:this.usernameFormControl,phone:this.phoneFormControl})}ngOnInit(){this.fetchSettings().subscribe(),this.getSettings().subscribe(),this.handleOnUpdateSuccess().subscribe(),this.handleOnUpdateFailure().subscribe()}getNotificationPreference(){switch(this.settings().notificationsPreference){case d.email:return"Email notifications";case d.browser:return"Browser notifications";default:return"No notifications"}}getProfileVisibility(){return this.settings()?this.settings().profileVisibility?"Public":"Private":""}updateSettings(){this.isEditing.update(i=>!i);let t=this.settings().notificationsPreference===d.email?"1":"2";this.formGroup.patchValue({notificationPreference:t,profileVisibility:this.settings().profileVisibility,username:this.settings().username,phone:this.settings().phone})}exportToCSV(){if(!this.settings())return;let t={username:this.settings().username,phone:this.settings().phone,notificationsPreference:this.getNotificationPreference(),profileVisibility:this.getProfileVisibility()},i=",",s=Object.keys(t),P=[s.join(i),s.map(pt=>{let dt=pt;return this.escapeCsvValue(t[dt])}).join(i)].join(`
`),mt=new Blob([P],{type:"text/csv;charset=utf-8;"});this.anchorTagAndDownload(mt,`${t.username}_data.csv`)}saveSettings(){if(this.formGroup.valid){this.isLoading.update(()=>!0);let t={username:this.usernameFormControl.value,phone:this.phoneFormControl.value,notificationsPreference:this.notificationPreferenceFormControl.value==="1"?d.email:d.browser,profileVisibility:this.profileVisibilityFormControl.value};this.store.dispatch(N({settings:t}))}}anchorTagAndDownload(t,i){let s=document.createElement("a"),P=URL.createObjectURL(t);s.setAttribute("href",P),s.setAttribute("download",i),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}escapeCsvValue(t){return t==null?"":(t=t.toString(),t.search(/("|,|\n)/g)>=0&&(t=`"${t.replace(/"/g,'""')}"`),t)}getSettings(){return this.store.select(ct).pipe(f(t=>{t&&this.settings.set(t)}))}fetchSettings(){return this.store.select(B).pipe(E(1),f(t=>{t&&this.store.dispatch(I({userId:t}))}))}handleOnUpdateSuccess(){return this.actions$.pipe(w(j),f(()=>{this.isLoading.update(()=>!1),this.isEditing.update(()=>!1)}))}handleOnUpdateFailure(){return this.actions$.pipe(w(L),f(()=>{this.isLoading.update(()=>!1)}))}};c.\u0275fac=function(i){return new(i||c)(v(A),v(T))},c.\u0275cmp=F({type:c,selectors:[["app-settings"]],standalone:!0,features:[O],decls:2,vars:1,consts:[["data-settings-section","",1,"settings-section-container"],["data-settings-container","",1,"settings-card-container"],["aria-label","name of the user",1,"settings-title-text"],[1,"settings-options"],["aria-label","user notifications preference"],["aria-label","user profile visibility"],["aria-label","user username"],["aria-label","user phone number"],["aria-label","post action button section"],["mat-button","","data-export-csv-btn","","aria-label","export to CSV button",3,"click"],["mat-button","","data-update-settings-btn","","aria-label","update settings button",3,"click"],["aria-label","update settings title",1,"settings-title-text"],["data-update-settings-form","",3,"ngSubmit","formGroup"],[1,"form-group-container"],["aria-label","Select notification preference",3,"formControl"],["aria-label","Email Notifications","aria-checked","true","data-notification-email-field","","value","1"],["aria-label","Browser Notifications","aria-checked","false","data-notification-browser-field","","value","2"],["color","primary","aria-label","Profile Visibility slide button","data-profile-privacy-toggle-btn","",3,"formControl"],["aria-label","Username"],["type","text","matInput","","aria-placeholder","Update your Username","placeholder","Enter your new username","aria-required","false","data-update-username-field","",3,"formControl"],["aria-label","Phone number"],["type","tel","matInput","","aria-placeholder","Update your phone number","placeholder","Enter your new Phone number","aria-required","false","data-update-phone-field","",3,"formControl"],["type","submit","mat-button","","data-submit-settings-btn","","aria-label","Submit settings button",3,"disabled"]],template:function(i,s){i&1&&(n(0,"section",0),_(1,bt,3,1,"mat-card",1),o()),i&2&&(l(),x(1,s.settings()?1:-1))},dependencies:[U,tt,X,J,K,Q,Y,Z,lt,it,et,nt,D,R,z,q,H,$,ot,rt,at,st],styles:[".settings-section-container[_ngcontent-%COMP%]{align-items:center;box-sizing:border-box;display:flex;flex-direction:column;height:100%;justify-content:center;padding-right:30px;padding-left:30px;width:100%}.settings-section-container[_ngcontent-%COMP%]   .settings-card-container[_ngcontent-%COMP%]{width:30%;box-shadow:-14px 4px 50px #0000004d}.settings-section-container[_ngcontent-%COMP%]   .settings-title-text[_ngcontent-%COMP%]{color:#d0bcff}.settings-section-container[_ngcontent-%COMP%]   .settings-options[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:1rem;line-height:10px}.settings-section-container[_ngcontent-%COMP%]   .form-group-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-evenly;gap:10px}.settings-section-container[_ngcontent-%COMP%]   .form-group-container[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding-bottom:10px}@media screen and (min-width: 320px){.settings-section-container[_ngcontent-%COMP%]   .settings-card-container[_ngcontent-%COMP%]{width:90%}.settings-section-container[_ngcontent-%COMP%]   .settings-options[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:7px 0}}"]});let e=c;return e})();export{qt as SettingsComponent};
